<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADAC Diagram Generator</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; background: #fdfdfd; color: #333; }
        h1 { color: #232f3e; }
        .controls { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 1px solid #eee; display: flex; flex-direction: column; gap: 15px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        label { font-weight: 500; }
        input[type="file"] { padding: 10px; border: 1px dashed #ccc; border-radius: 4px; }
        .radio-group { display: flex; gap: 20px; }
        .radio-group label { font-weight: normal; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        button { background: #ec7211; color: white; border: none; padding: 12px 20px; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.2s; align-self: flex-start; }
        button:hover { background: #eb5f07; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #output { margin-top: 30px; border: 1px solid #ddd; padding: 10px; background: #fff; min-height: 200px; display: flex; align-items: center; justify-content: center; }
        #output svg { width: 100%; height: auto; }
        .error { color: #d13212; background: #fff5f5; padding: 10px; border-left: 3px solid #d13212; }
    </style>
</head>
<body>
    <h1>ADAC Diagram Generator</h1>
    <p>Upload your <code>.adac.yaml</code> file to generate an architecture diagram.</p>
    
    <div class="controls">
        <div class="form-group">
            <label for="yamlFile">1. Select YAML File</label>
            <input type="file" id="yamlFile" accept=".yaml,.yml">
        </div>

        <div class="form-group">
            <label>2. Choose Layout Engine</label>
            <div class="radio-group">
                <label><input type="radio" name="layout" value="elk" checked> ELK (Recommended)</label>
                <label><input type="radio" name="layout" value="dagre"> Dagre</label>
            </div>
        </div>

        <button id="generateBtn">Generate Diagram</button>
    </div>

    <div id="output">
        <span style="color: #999;">Diagram will appear here...</span>
    </div>

    <script>
        const generateBtn = document.getElementById('generateBtn');
        const fileInput = document.getElementById('yamlFile');
        const output = document.getElementById('output');

        generateBtn.addEventListener('click', async () => {
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a file first.');
                return;
            }

            const layout = document.querySelector('input[name="layout"]:checked').value;
            const formData = new FormData();
            formData.append('file', file);
            formData.append('layout', layout);

            generateBtn.disabled = true;
            generateBtn.innerText = 'Generating...';
            output.innerHTML = '<span style="color: #666;">Processing...</span>';

            try {
                // Read file content explicitly to send as JSON/text if needed, 
                // but FormData typically sends as multipart/form-data which Vercel/Node can parse.
                // However, for simplicity in a serverless function without heavyweight middleware, 
                // sending text content might be easier if file is small.
                // Let's stick to simple text body for now since YAML is text.
                
                const text = await file.text();
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: text,
                        layout: layout
                    })
                });

                if (!response.ok) {
                    const err = await response.text();
                    throw new Error(err || 'Failed to generate');
                }

                const svg = await response.text();
                output.innerHTML = svg;
            } catch (e) {
                output.innerHTML = `<div class="error">Error: ${e.message}</div>`;
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerText = 'Generate Diagram';
            }
        });
    </script>
</body>
</html>
